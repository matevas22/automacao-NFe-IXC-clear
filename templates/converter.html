{% extends 'layout.html' %} {% block title %}Conversor PDF para Excel{% endblock
%} {% block styles %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/converter.css') }}"
/>
{% endblock %} {% block content %}
<div class="converter-container">
  <div class="converter-header">
    <h1>Converter PDF para Excel</h1>
    <p>Converta seus arquivos PDF para planilhas Excel edit√°veis facilmente.</p>
  </div>

  <form
    action="{{ url_for('convert_pdf') }}"
    method="post"
    enctype="multipart/form-data"
    id="converterForm"
  >
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <label for="pdf_file" class="upload-area" id="drop-area">
      <div class="upload-icon">üìÑ</div>
      <h3>Clique ou arraste seu arquivo PDF aqui</h3>
      <p>Selecione um arquivo PDF para converter</p>
      <input
        type="file"
        name="pdf_file"
        id="pdf_file"
        accept=".pdf"
        required
        onchange="handleFileSelect(this)"
      />
      <div id="file-name-display" class="file-name"></div>
    </label>

    <div class="page-options" id="page-options-panel">
      <h3>Op√ß√µes de Convers√£o</h3>

      <div class="option-group">
        <label class="radio-option">
          <input
            type="radio"
            name="conversion_mode"
            value="all"
            checked
            onchange="togglePageInput()"
          />
          Todas as p√°ginas
        </label>
        <label class="radio-option">
          <input
            type="radio"
            name="conversion_mode"
            value="single"
            onchange="togglePageInput()"
          />
          P√°ginas espec√≠ficas
        </label>
      </div>

      <div class="page-input-wrapper" id="specific-page-input">
        <input
          type="text"
          name="pages"
          class="page-input"
          placeholder="Ex: 1, 3, 5-7"
        />
        <div class="page-help">
          Digite os n√∫meros das p√°ginas (ex: 1 ou 1,3,5)
        </div>
      </div>
    </div>

    <button
      type="submit"
      class="btn-convert"
      id="btn-convert"
      style="display: none"
    >
      Converter em Excel
    </button>
  </form>

  <div class="pdf-preview-container" id="pdf-preview"></div>
</div>

<script>
  function handleFileSelect(input) {
    const file = input.files[0];
    const display = document.getElementById("file-name-display");
    const previewContainer = document.getElementById("pdf-preview");
    const optionsPanel = document.getElementById("page-options-panel");
    const submitBtn = document.getElementById("btn-convert");

    if (file) {
      display.textContent = "Arquivo selecionado: " + file.name;
      document.querySelector(".upload-area h3").textContent = "Arquivo Pronto!";

      optionsPanel.style.display = "block";
      submitBtn.style.display = "inline-block";

      const fileURL = URL.createObjectURL(file);

      previewContainer.innerHTML = "";
      const iframe = document.createElement("iframe");
      iframe.src = fileURL;
      previewContainer.appendChild(iframe);
      previewContainer.style.display = "block";
    }
  }

  function togglePageInput() {
    const mode = document.querySelector(
      'input[name="conversion_mode"]:checked',
    ).value;
    const inputWrapper = document.getElementById("specific-page-input");

    if (mode === "single") {
      inputWrapper.style.display = "block";
    } else {
      inputWrapper.style.display = "none";
    }
  }

  // Drag and drop support
  const dropArea = document.getElementById("drop-area");
  const fileInput = document.getElementById("pdf_file");

  ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
    dropArea.addEventListener(eventName, preventDefaults, false);
  });

  function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  ["dragenter", "dragover"].forEach((eventName) => {
    dropArea.addEventListener(eventName, highlight, false);
  });

  ["dragleave", "drop"].forEach((eventName) => {
    dropArea.addEventListener(eventName, unhighlight, false);
  });

  function highlight(e) {
    dropArea.style.borderColor = "var(--accent-color)";
    dropArea.style.backgroundColor = "#eff6ff";
  }

  function unhighlight(e) {
    dropArea.style.borderColor = "var(--border-color)";
    dropArea.style.backgroundColor = "var(--input-bg)";
  }

  dropArea.addEventListener("drop", handleDrop, false);

  function handleDrop(e) {
    const dt = e.dataTransfer;
    const files = dt.files;
    fileInput.files = files;
    handleFileSelect(fileInput);
  }
</script>
{% endblock %}
